# Wagmi Chain Local Development Environment
# 
# This docker-compose file sets up a local EVM chain for development and testing.
# It includes:
# - Anvil (Foundry) - Fast local EVM chain
# - Blockscout - Block explorer
# - PostgreSQL - Database for Blockscout
#
# Usage:
#   cd wagmi-chain/local
#   docker-compose up -d
#
# Chain will be available at:
#   RPC: http://localhost:8545
#   WebSocket: ws://localhost:8545
#   Explorer: http://localhost:4000
#
# Default accounts (Anvil):
#   Private Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
#   Address: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
#   Balance: 10000 ETH

version: '3.8'

services:
  # ============================================================================
  # WAGMI CHAIN (Anvil)
  # ============================================================================
  wagmi-chain:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: wagmi-chain
    ports:
      - "8545:8545"
    command: >
      anvil
      --host 0.0.0.0
      --port 8545
      --chain-id 420420
      --block-time 1
      --accounts 10
      --balance 10000
      --gas-limit 30000000
      --code-size-limit 100000
      --steps-tracing
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "cast", "block-number", "--rpc-url", "http://localhost:8545"]
      interval: 5s
      timeout: 5s
      retries: 5

  # ============================================================================
  # DATABASE (for Blockscout)
  # ============================================================================
  postgres:
    image: postgres:14
    container_name: wagmi-postgres
    environment:
      POSTGRES_USER: blockscout
      POSTGRES_PASSWORD: blockscout
      POSTGRES_DB: blockscout
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U blockscout"]
      interval: 5s
      timeout: 5s
      retries: 5

  # ============================================================================
  # BLOCK EXPLORER (Blockscout)
  # ============================================================================
  blockscout:
    image: blockscout/blockscout:latest
    container_name: wagmi-explorer
    depends_on:
      postgres:
        condition: service_healthy
      wagmi-chain:
        condition: service_healthy
    ports:
      - "4000:4000"
    environment:
      # Database
      DATABASE_URL: postgresql://blockscout:blockscout@postgres:5432/blockscout
      
      # Network
      ETHEREUM_JSONRPC_VARIANT: geth
      ETHEREUM_JSONRPC_HTTP_URL: http://wagmi-chain:8545
      ETHEREUM_JSONRPC_WS_URL: ws://wagmi-chain:8545
      
      # Chain Info
      CHAIN_ID: 420420
      NETWORK: "Wagmi Chain"
      SUBNETWORK: "Wagmi Chain Local"
      COIN: ETH
      COIN_NAME: Ether
      
      # Features
      DISABLE_EXCHANGE_RATES: "true"
      INDEXER_DISABLE_INTERNAL_TRANSACTIONS_FETCHER: "true"
      INDEXER_DISABLE_PENDING_TRANSACTIONS_FETCHER: "true"
      
      # UI
      LOGO: /images/wagmi-logo.png
      FOOTER_LOGO: /images/wagmi-logo.png
      SUPPORTED_CHAINS: "[]"
      
      # Performance
      POOL_SIZE: 10
      ECTO_USE_SSL: "false"
    restart: unless-stopped

volumes:
  postgres_data:


